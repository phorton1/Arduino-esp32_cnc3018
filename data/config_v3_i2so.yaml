# config_v3.yaml for 20mm machine
# 16 tooth M3 sprocket

# The switch labels are bogus
# This is valid

#    S3  S4    steps/rev    steps per mm           
#     0   0     1600        33.33       33.3333
#     1   0     3200        33.33 * 2   66.6666
#     0   1      400        33.33 / 4   8.333333
#     1   1      200        33.33 / 8   4.166666
#
# Using 66.66 (s3=1, s4=0), and 16us pulses I found
# that S1=1,S2=1 for "decay" is generally quietest, and 
# I use (S5=0, S6=1) for "50% torque and am starting
# with the defaults of SW1=1, SW2=0, and SW3=0 for
# a current limit of 1.5A, so my defaults for the
# X,A, and Y axis are
#
#    S1 = 1
#    S2 = 1
#    S3 = 1
#    S4 = 0
#    S5 = 0
#    S6 = 1


name: "CNC20MM"
board: "esp32_cnc20mm Board"


stepping:
    engine:  I2S_STREAM
        # RMT
    idle_ms: 250
        # !! 255 disables the "disable/enable" pin(s)
    pulse_us: 16
    dir_delay_us: 16
    disable_delay_us: 16

axes:
    shared_stepper_disable_pin: gpio.13:low
        
    x:
        steps_per_mm: 66.666
        max_rate_mm_per_min:8000
        acceleration_mm_per_sec2: 30
        max_travel_mm: 2000
        motor0:
            # hard_limits: true
            # limit_neg_pin: I2SI.3:low
            # limit_pos_pin: I2SI.2:low
            pulloff_mm: 5
            standard_stepper:
                step_pin: I2SO.6
                direction_pin: I2SO.7
        homing:
            cycle: 2
            seek_mm_per_min: 500
            feed_mm_per_min: 80
            positive_direction: false
    a:
        steps_per_mm: 66.666
        max_rate_mm_per_min:8000
        acceleration_mm_per_sec2: 30
        max_travel_mm: 2000
        motor0:
            # hard_limits: true
            # limit_neg_pin: I2SI.3:low
            # limit_pos_pin: I2SI.2:low
            pulloff_mm: 5
            standard_stepper:
                step_pin: I2SO.4
                direction_pin: I2SO.5
        homing:
            cycle: 2
            seek_mm_per_min: 500
            feed_mm_per_min: 80
            positive_direction: false
    y:
        steps_per_mm: 66.666
        max_rate_mm_per_min:8000
        acceleration_mm_per_sec2: 30
        max_travel_mm: 2000
        motor0:
            # hard_limits: true
            # limit_neg_pin: I2SI.3:low
            # limit_pos_pin: I2SI.2:low
            pulloff_mm: 5
            standard_stepper:
                step_pin: I2SO.2
                direction_pin: I2SO.3
        homing:
            cycle: 2
            seek_mm_per_min: 500
            feed_mm_per_min: 80
            positive_direction: false
    z:
        steps_per_mm: 66.666
        max_rate_mm_per_min:8000
        acceleration_mm_per_sec2: 30
        max_travel_mm: 2000
        motor0:
            # hard_limits: true
            # limit_neg_pin: I2SI.3:low
            # limit_pos_pin: I2SI.2:low
            pulloff_mm: 5
            standard_stepper:
                step_pin: I2SO.0
                direction_pin: I2SO.1
        homing:
            cycle: 2
            seek_mm_per_min: 500
            feed_mm_per_min: 80



 
# PWM:
#     output_pin: gpio.2
#     pwm_hz: 2000
#     speed_map: 0=0% 1=5% 100=100%
            
spi:
    # one has to tell FluidNC the default ESP32 SPI pins!
    miso_pin: gpio.19
    mosi_pin: gpio.23
    sck_pin: gpio.18
    
sdcard:
    # and then one can specify the specific cs used for the SDCard
    cs_pin: gpio.4
    card_detect_pin: NO_PIN
    
i2so:
    # bck_pin: gpio.22
    # data_pin: gpio.21
    # ws_pin: gpio.17
    
    bck_pin:   gpio.26
    ws_pin:    gpio.25
    data_pin:  gpio.33
    
i2si:
    bck_pin:   gpio.32
    ws_pin:    gpio.2
    data_pin:  gpio.36
    use_shift_in: true
  
probe:
    pin: I2SI.5:low
    check_mode_start: true
    
start:
  must_home: false
  

